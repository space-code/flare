name: Publish Page Action

inputs:
  target:
    required: true
    type: string
  base_path:
    required: true
    type: string

runs:
  using: "composite"

  steps:
    - name: Build DocC
      shell: bash
      run: |
        mkdir ./docs;
        swift build;
        swift package \
          --allow-writing-to-directory ./docs \
          generate-documentation \
          --target ${{ inputs.target }} \
          --output-path ./docs/${{ inputs.base_path }} \
          --transform-for-static-hosting \
          --hosting-base-path flare/${{ inputs.base_path }};

    - name: Commit and push generated documentation
      uses: actions/checkout@v3
      shell: bash
      run: |
        cp -r ./docs/${{ inputs.base_path }} ./${{ inputs.base_path }}

        git config --local user.email "github-actions[bot]@users.noreply.github.com"
        git config --local user.name "github-actions[bot]"
        git switch gh-pages
        git add ./${{ inputs.base_path }}
        git commit -a -m "Generated ${{ inputs.target }} Swift DocC"
        git push origin gh-pages