{"identifier":{"interfaceLanguage":"swift","url":"doc:\/\/Flare\/documentation\/Flare\/perform-purchase"},"metadata":{"role":"article","roleHeading":"Article","modules":[{"name":"Flare"}],"title":"Perform Purchase"},"schemaVersion":{"minor":3,"major":0,"patch":0},"abstract":[{"type":"text","text":"Learn how to perform a purchase."}],"hierarchy":{"paths":[["doc:\/\/Flare\/documentation\/Flare"]]},"seeAlsoSections":[{"generated":true,"title":"Articles","identifiers":["doc:\/\/Flare\/documentation\/Flare\/restore-purchase","doc:\/\/Flare\/documentation\/Flare\/refund-purchase","doc:\/\/Flare\/documentation\/Flare\/promotional-offers","doc:\/\/Flare\/documentation\/Flare\/logging"]}],"kind":"article","sections":[],"primaryContentSections":[{"kind":"content","content":[{"text":"Setup Observers","level":2,"type":"heading","anchor":"Setup-Observers"},{"style":"tip","name":"Tip","content":[{"inlineContent":[{"type":"text","text":"This step isn’t required if the app uses system higher than iOS 15.0, tvOS 15.0, watchOS 8.0, macOS 12.0."}],"type":"paragraph"}],"type":"aside"},{"inlineContent":[{"type":"text","text":"The transactions array will only be synchronized with the server while the queue has observers. These methods may require that the user authenticate. It is important to set an observer on this queue as early as possible after your app launch. Observer is responsible for processing all events triggered by the queue."}],"type":"paragraph"},{"type":"codeListing","syntax":"swift","code":["\/\/ Adds transaction observer to the payment queue and handles payment transactions.","Flare.shared.addTransactionObserver { result in","    switch result {","    case let .success(transaction):","        debugPrint(\"A transaction was received: \\(transaction)\")","    case let .failure(error):","        debugPrint(\"An error occurred while adding transaction observer: \\(error.localizedDescription)\")","    }","}"]},{"code":["\/\/ Removes transaction observer from the payment queue.","Flare.shared.removeTransactionObserver()"],"type":"codeListing","syntax":"swift"},{"anchor":"Getting-Products","level":2,"text":"Getting Products","type":"heading"},{"inlineContent":[{"type":"text","text":"The fetch method sends a request to the App Store, which retrieves the products if they are available. The productIDs parameter takes the product ids, which should be given from the App Store."}],"type":"paragraph"},{"name":"Important","style":"important","type":"aside","content":[{"inlineContent":[{"text":"Before attempting to add a payment always check if the user can actually make payments. The Flare does it under the hood, if a user cannot make payments, you will get an ","type":"text"},{"type":"reference","isActive":true,"identifier":"doc:\/\/Flare\/documentation\/Flare\/IAPError\/paymentNotAllowed"},{"type":"text","text":"."}],"type":"paragraph"}]},{"syntax":"swift","code":["Flare.shared.fetch(productIDs: [\"product_id\"]) { result in","    switch result {","    case let .success(products):","        debugPrint(\"Fetched products: \\(products)\")","    case let .failure(error):","        debugPrint(\"An error occurred while fetching products: \\(error.localizedDescription)\")","    }","}"],"type":"codeListing"},{"inlineContent":[{"text":"Additionally, there is an ","type":"text"},{"code":"await","type":"codeVoice"},{"text":" version of the ","type":"text"},{"type":"reference","identifier":"doc:\/\/Flare\/documentation\/Flare\/IFlare\/fetch(productIDs:)","isActive":true},{"type":"text","text":" method."}],"type":"paragraph"},{"syntax":"swift","type":"codeListing","code":["do {","    let products = try await Flare.shared.fetch(productIDs: Set(arrayLiteral: [\"product_id\"]))","} catch {","    debugPrint(\"An error occurred while fetching products: \\(error.localizedDescription)\")","}"]},{"style":"note","name":"Note","type":"aside","content":[{"inlineContent":[{"type":"text","text":"Products are cached by default. If caching is not possible for specific usecases, set "},{"type":"reference","isActive":true,"identifier":"doc:\/\/Flare\/documentation\/Flare\/Configuration\/fetchCachePolicy"},{"text":" to ","type":"text"},{"type":"reference","identifier":"doc:\/\/Flare\/documentation\/Flare\/FetchCachePolicy\/fetch","isActive":true},{"text":".","type":"text"}],"type":"paragraph"}]},{"syntax":"swift","code":["import Flare","","let configuration = Configuration(fetchCachePolicy: .fetch)","","Flare.configure(with: configuration)"],"type":"codeListing"},{"text":"Purchasing Product","level":2,"anchor":"Purchasing-Product","type":"heading"},{"inlineContent":[{"text":"Flare provides a few methods to perform a purchase:","type":"text"}],"type":"paragraph"},{"items":[{"content":[{"inlineContent":[{"type":"reference","isActive":true,"identifier":"doc:\/\/Flare\/documentation\/Flare\/IFlare\/purchase(product:completion:)"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"identifier":"doc:\/\/Flare\/documentation\/Flare\/IFlare\/purchase(product:)","type":"reference","isActive":true}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"reference","identifier":"doc:\/\/Flare\/documentation\/Flare\/IFlare\/purchase(product:options:)","isActive":true}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"isActive":true,"type":"reference","identifier":"doc:\/\/Flare\/documentation\/Flare\/IFlare\/purchase(product:options:completion:)"}],"type":"paragraph"}]}],"type":"unorderedList"},{"type":"paragraph","inlineContent":[{"type":"text","text":"The method accepts a product parameter which represents a product:"}]},{"type":"codeListing","syntax":"swift","code":["Flare.shared.purchase(product: product) { result in ","    switch result {","    case let .success(transaction):","        debugPrint(\"A transaction was received: \\(transaction)\")","    case let .failure(error):","        debugPrint(\"An error occurred while purchasing product: \\(error.localizedDescription)\")","    }","}"]},{"type":"paragraph","inlineContent":[{"text":"If your app has a deployment target higher than iOS 15.0, tvOS 15.0, watchOS 8.0, macOS 12.0, you can pass a set of ","type":"text"},{"isActive":true,"identifier":"https:\/\/developer.apple.com\/documentation\/storekit\/product\/purchaseoption","type":"reference"},{"text":" along with a purchase request.","type":"text"}]},{"type":"codeListing","syntax":"swift","code":["let transaction = try await Flare.shared.purchase(product: product, options: [.appAccountToken(UUID())])"]},{"anchor":"Finishing-Transaction","type":"heading","text":"Finishing Transaction","level":2},{"inlineContent":[{"type":"text","text":"Finishing a transaction tells StoreKit that your app completed its workflow to make a purchase complete. Unfinished transactions remain in the queue until they’re finished, so be sure to add the transaction queue observer every time your app launches, to enable your app to finish the transactions. Your app needs to finish each transaction, whether it succeeds or fails."}],"type":"paragraph"},{"type":"paragraph","inlineContent":[{"type":"text","text":"To finish the transaction, call the "},{"isActive":true,"identifier":"doc:\/\/Flare\/documentation\/Flare\/IFlare\/finish(transaction:completion:)","type":"reference"},{"type":"text","text":" method."}]},{"type":"codeListing","code":["Flare.shared.finish(transaction: transaction, completion: nil)"],"syntax":"swift"},{"type":"aside","name":"Important","style":"important","content":[{"inlineContent":[{"text":"Don’t call the ","type":"text"},{"type":"reference","identifier":"doc:\/\/Flare\/documentation\/Flare\/IFlare\/finish(transaction:completion:)","isActive":true},{"text":" method before the transaction is actually complete and attempt to use some other mechanism in your app to track the transaction as unfinished. StoreKit doesn’t function that way, and doing that prevents your app from downloading Apple-hosted content and can lead to other issues.","type":"text"}],"type":"paragraph"}]}]}],"variants":[{"traits":[{"interfaceLanguage":"swift"}],"paths":["\/documentation\/flare\/perform-purchase"]}],"references":{"doc://Flare/documentation/Flare/IFlare/purchase(product:options:)":{"identifier":"doc:\/\/Flare\/documentation\/Flare\/IFlare\/purchase(product:options:)","role":"symbol","fragments":[{"text":"func","kind":"keyword"},{"text":" ","kind":"text"},{"text":"purchase","kind":"identifier"},{"kind":"text","text":"("},{"kind":"externalParam","text":"product"},{"kind":"text","text":": "},{"text":"StoreProduct","kind":"typeIdentifier","preciseIdentifier":"c:@M@Flare@objc(cs)StoreProduct"},{"kind":"text","text":", "},{"text":"options","kind":"externalParam"},{"kind":"text","text":": "},{"preciseIdentifier":"s:Sh","kind":"typeIdentifier","text":"Set"},{"kind":"text","text":"<"},{"kind":"typeIdentifier","text":"Product","preciseIdentifier":"s:8StoreKit7ProductV"},{"text":".","kind":"text"},{"kind":"typeIdentifier","text":"PurchaseOption","preciseIdentifier":"s:8StoreKit7ProductV14PurchaseOptionV"},{"text":">) ","kind":"text"},{"text":"async","kind":"keyword"},{"text":" ","kind":"text"},{"text":"throws","kind":"keyword"},{"text":" -> ","kind":"text"},{"preciseIdentifier":"s:5Flare16StoreTransactionC","text":"StoreTransaction","kind":"typeIdentifier"}],"url":"\/documentation\/flare\/iflare\/purchase(product:options:)","type":"topic","abstract":[{"text":"Purchases a product.","type":"text"}],"title":"purchase(product:options:)","kind":"symbol"},"doc://Flare/documentation/Flare/IFlare/purchase(product:completion:)":{"identifier":"doc:\/\/Flare\/documentation\/Flare\/IFlare\/purchase(product:completion:)","role":"symbol","fragments":[{"text":"func","kind":"keyword"},{"text":" ","kind":"text"},{"text":"purchase","kind":"identifier"},{"text":"(","kind":"text"},{"text":"product","kind":"externalParam"},{"kind":"text","text":": "},{"preciseIdentifier":"c:@M@Flare@objc(cs)StoreProduct","text":"StoreProduct","kind":"typeIdentifier"},{"kind":"text","text":", "},{"kind":"externalParam","text":"completion"},{"kind":"text","text":": "},{"kind":"typeIdentifier","text":"Closure","preciseIdentifier":"s:5Flare7Closurea"},{"text":"<","kind":"text"},{"text":"Result","preciseIdentifier":"s:s6ResultO","kind":"typeIdentifier"},{"text":"<","kind":"text"},{"text":"StoreTransaction","kind":"typeIdentifier","preciseIdentifier":"s:5Flare16StoreTransactionC"},{"kind":"text","text":", "},{"text":"IAPError","kind":"typeIdentifier","preciseIdentifier":"s:5Flare8IAPErrorO"},{"kind":"text","text":">>)"}],"url":"\/documentation\/flare\/iflare\/purchase(product:completion:)","type":"topic","abstract":[{"type":"text","text":"Performs a purchase of a product."}],"kind":"symbol","title":"purchase(product:completion:)"},"doc://Flare/documentation/Flare/Configuration/fetchCachePolicy":{"identifier":"doc:\/\/Flare\/documentation\/Flare\/Configuration\/fetchCachePolicy","role":"symbol","fragments":[{"kind":"keyword","text":"let"},{"text":" ","kind":"text"},{"kind":"identifier","text":"fetchCachePolicy"},{"text":": ","kind":"text"},{"preciseIdentifier":"s:5Flare16FetchCachePolicyO","text":"FetchCachePolicy","kind":"typeIdentifier"}],"url":"\/documentation\/flare\/configuration\/fetchcachepolicy","type":"topic","abstract":[{"type":"text","text":"The cache policy for fetching products."}],"title":"fetchCachePolicy","kind":"symbol"},"doc://Flare/documentation/Flare/IFlare/purchase(product:options:completion:)":{"identifier":"doc:\/\/Flare\/documentation\/Flare\/IFlare\/purchase(product:options:completion:)","role":"symbol","fragments":[{"text":"func","kind":"keyword"},{"text":" ","kind":"text"},{"kind":"identifier","text":"purchase"},{"text":"(","kind":"text"},{"kind":"externalParam","text":"product"},{"text":": ","kind":"text"},{"preciseIdentifier":"c:@M@Flare@objc(cs)StoreProduct","text":"StoreProduct","kind":"typeIdentifier"},{"kind":"text","text":", "},{"kind":"externalParam","text":"options"},{"kind":"text","text":": "},{"kind":"typeIdentifier","text":"Set","preciseIdentifier":"s:Sh"},{"text":"<","kind":"text"},{"kind":"typeIdentifier","text":"Product","preciseIdentifier":"s:8StoreKit7ProductV"},{"text":".","kind":"text"},{"text":"PurchaseOption","kind":"typeIdentifier","preciseIdentifier":"s:8StoreKit7ProductV14PurchaseOptionV"},{"text":">, ","kind":"text"},{"text":"completion","kind":"externalParam"},{"text":": ","kind":"text"},{"preciseIdentifier":"s:5Flare15SendableClosurea","kind":"typeIdentifier","text":"SendableClosure"},{"text":"<","kind":"text"},{"preciseIdentifier":"s:s6ResultO","text":"Result","kind":"typeIdentifier"},{"text":"<","kind":"text"},{"text":"StoreTransaction","kind":"typeIdentifier","preciseIdentifier":"s:5Flare16StoreTransactionC"},{"kind":"text","text":", "},{"text":"IAPError","kind":"typeIdentifier","preciseIdentifier":"s:5Flare8IAPErrorO"},{"kind":"text","text":">>)"}],"url":"\/documentation\/flare\/iflare\/purchase(product:options:completion:)","type":"topic","abstract":[{"type":"text","text":"Purchases a product."}],"kind":"symbol","title":"purchase(product:options:completion:)"},"doc://Flare/documentation/Flare/FetchCachePolicy/fetch":{"identifier":"doc:\/\/Flare\/documentation\/Flare\/FetchCachePolicy\/fetch","role":"symbol","fragments":[{"kind":"keyword","text":"case"},{"text":" ","kind":"text"},{"kind":"identifier","text":"fetch"}],"url":"\/documentation\/flare\/fetchcachepolicy\/fetch","type":"topic","abstract":[{"type":"text","text":"Fetch the current data without using the cache."}],"title":"FetchCachePolicy.fetch","kind":"symbol"},"doc://Flare/documentation/Flare/promotional-offers":{"identifier":"doc:\/\/Flare\/documentation\/Flare\/promotional-offers","role":"article","url":"\/documentation\/flare\/promotional-offers","type":"topic","abstract":[{"type":"text","text":"Learn how to use promotional offers."}],"kind":"article","title":"Promotional Offers"},"doc://Flare/documentation/Flare/logging":{"identifier":"doc:\/\/Flare\/documentation\/Flare\/logging","role":"article","url":"\/documentation\/flare\/logging","type":"topic","abstract":[{"type":"text","text":"Learn how to log important events."}],"title":"Logging","kind":"article"},"doc://Flare/documentation/Flare":{"abstract":[{"type":"text","text":"Flare provides an elegant interface for In-App Purchases, supporting non-consumable and consumable purchases as well as subscriptions."}],"type":"topic","identifier":"doc:\/\/Flare\/documentation\/Flare","kind":"symbol","url":"\/documentation\/flare","role":"collection","title":"Flare"},"doc://Flare/documentation/Flare/restore-purchase":{"identifier":"doc:\/\/Flare\/documentation\/Flare\/restore-purchase","role":"article","url":"\/documentation\/flare\/restore-purchase","type":"topic","abstract":[{"type":"text","text":"Learn how to restore a purchase."}],"kind":"article","title":"Restore Purchase"},"doc://Flare/documentation/Flare/IFlare/fetch(productIDs:)":{"abstract":[{"type":"text","text":"Retrieves localized information from the App Store about a specified list of products."}],"fragments":[{"kind":"keyword","text":"func"},{"text":" ","kind":"text"},{"kind":"identifier","text":"fetch"},{"text":"(","kind":"text"},{"text":"productIDs","kind":"externalParam"},{"text":": some ","kind":"text"},{"text":"Collection","kind":"typeIdentifier","preciseIdentifier":"s:Sl"},{"text":"<","kind":"text"},{"kind":"typeIdentifier","preciseIdentifier":"s:SS","text":"String"},{"kind":"text","text":">) "},{"kind":"keyword","text":"async"},{"text":" ","kind":"text"},{"text":"throws","kind":"keyword"},{"kind":"text","text":" -> ["},{"preciseIdentifier":"c:@M@Flare@objc(cs)StoreProduct","kind":"typeIdentifier","text":"StoreProduct"},{"text":"]","kind":"text"}],"url":"\/documentation\/flare\/iflare\/fetch(productids:)","required":true,"identifier":"doc:\/\/Flare\/documentation\/Flare\/IFlare\/fetch(productIDs:)","role":"symbol","title":"fetch(productIDs:)","type":"topic","kind":"symbol"},"doc://Flare/documentation/Flare/refund-purchase":{"identifier":"doc:\/\/Flare\/documentation\/Flare\/refund-purchase","url":"\/documentation\/flare\/refund-purchase","kind":"article","type":"topic","abstract":[{"text":"Learn how to process a refund through an iOS app.","type":"text"}],"title":"Refund Purchase","role":"article"},"https://developer.apple.com/documentation/storekit/product/purchaseoption":{"titleInlineContent":[{"code":"options","type":"codeVoice"}],"type":"link","identifier":"https:\/\/developer.apple.com\/documentation\/storekit\/product\/purchaseoption","title":"options","url":"https:\/\/developer.apple.com\/documentation\/storekit\/product\/purchaseoption"},"doc://Flare/documentation/Flare/IFlare/purchase(product:)":{"abstract":[{"text":"Purchases a product.","type":"text"}],"url":"\/documentation\/flare\/iflare\/purchase(product:)","title":"purchase(product:)","fragments":[{"text":"func","kind":"keyword"},{"kind":"text","text":" "},{"text":"purchase","kind":"identifier"},{"text":"(","kind":"text"},{"text":"product","kind":"externalParam"},{"text":": ","kind":"text"},{"kind":"typeIdentifier","text":"StoreProduct","preciseIdentifier":"c:@M@Flare@objc(cs)StoreProduct"},{"text":") ","kind":"text"},{"kind":"keyword","text":"async"},{"text":" ","kind":"text"},{"text":"throws","kind":"keyword"},{"text":" -> ","kind":"text"},{"preciseIdentifier":"s:5Flare16StoreTransactionC","text":"StoreTransaction","kind":"typeIdentifier"}],"kind":"symbol","role":"symbol","type":"topic","identifier":"doc:\/\/Flare\/documentation\/Flare\/IFlare\/purchase(product:)"},"doc://Flare/documentation/Flare/IFlare/finish(transaction:completion:)":{"abstract":[{"type":"text","text":"Removes a finished (i.e. failed or completed) transaction from the queue."},{"text":" ","type":"text"},{"text":"Attempting to finish a purchasing transaction will throw an exception.","type":"text"}],"url":"\/documentation\/flare\/iflare\/finish(transaction:completion:)","title":"finish(transaction:completion:)","fragments":[{"text":"func","kind":"keyword"},{"kind":"text","text":" "},{"text":"finish","kind":"identifier"},{"kind":"text","text":"("},{"text":"transaction","kind":"externalParam"},{"text":": ","kind":"text"},{"text":"StoreTransaction","preciseIdentifier":"s:5Flare16StoreTransactionC","kind":"typeIdentifier"},{"text":", ","kind":"text"},{"kind":"externalParam","text":"completion"},{"text":": (() -> ","kind":"text"},{"text":"Void","preciseIdentifier":"s:s4Voida","kind":"typeIdentifier"},{"text":")?)","kind":"text"}],"kind":"symbol","required":true,"role":"symbol","type":"topic","identifier":"doc:\/\/Flare\/documentation\/Flare\/IFlare\/finish(transaction:completion:)"},"doc://Flare/documentation/Flare/IAPError/paymentNotAllowed":{"role":"symbol","abstract":[{"type":"text","text":"The attempt to purchase a product when payments are not allowed."}],"kind":"symbol","title":"IAPError.paymentNotAllowed","fragments":[{"text":"case","kind":"keyword"},{"text":" ","kind":"text"},{"kind":"identifier","text":"paymentNotAllowed"}],"type":"topic","identifier":"doc:\/\/Flare\/documentation\/Flare\/IAPError\/paymentNotAllowed","url":"\/documentation\/flare\/iaperror\/paymentnotallowed"}}}